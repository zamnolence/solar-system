{% extends 'base.html' %}

{% block head %}
<title>Profile | Solar System Quiz</title>

{% endblock %}

{% block body %}

<!-- User general info -->
<div class="container">
<table class="table user-table">
    <tr valign="top">
        <!-- Autogenerated avatar -->
        <td><img src="{{ user.avatar(128) }}"></td>
        <td>
            <h1>User: {{ user.username }}</h1>
            {% if user.about_me %}<p>{{ user.about_me }}</p>{% endif %}
            {% if user.last_seen %}<p>Last seen on: {{ user.last_seen.strftime('%B %d, %Y - %H:%M:%S') }}</p>{% endif %}
            {% if user == current_user %}
            <p><a href="{{ url_for('edit_profile') }}">Edit your profile</a></p>
            {% endif %}
        </td>
    </tr>
</table>
</div>

<!-- History -->
<div class="container">
    <h2 class="result-score">Total Score: {{ score }}</h2>
    <h2 class="history-bar">History</h2>
    <table class="result-table">
        <thead>
            <tr>
                <th>Module</th>
                <th>Score</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
        {% for score in scoreSorted %}
        {%  if loop.index <= 10  %}   <!-- Show top 5 attempts -->
            <tr>
                <td>{{ score.questionset_parent.name }}</td>
                <td>{{ score.score }}</td>
                <td>{{ score.time_taken }}</td>
            </tr>
        {% endif %}
        {% endfor %}
        </tbody>
    </table>
    <br>
</div>

<!-- Performance chart (calculated based on full score of 250) -->
<div class="container chart-container">
    <h2 class="history-bar">Your performance</h2>
    <ul class="horizontal-bar-chart">
      <li>
        <span class="index" style="width: calc( {{ vacuum_top.score }}/250 * 100%)">{{ vacuum_top.score / 250 * 100 }}%</span>
      </li>
        <p>{{ vacuum_top.questionset_parent.name }}</p>
      <li>
        <span class="index" style="width: calc( {{ planet_top.score }}/250 * 100%)">{{ planet_top.score / 250 * 100 }}%</span>
      </li>
      <p>{{ planet_top.questionset_parent.name }}</p>
      <li>
        <span class="index" style="width: calc( {{ satellite_top.score }}/250 * 100%)">{{ satellite_top.score / 250 * 100 }}%</span>
      </li>
      <p>{{ satellite_top.questionset_parent.name }}</p>
      
      <li>
        <span class="index" style="width: calc( {{ sun_top.score }}/250 * 100%)">{{ sun_top.score /250 * 100 }}%</span>
      </li>
      <p>{{ sun_top.questionset_parent.name }}</p>
    </ul>
</div>

<hr class="divider" />

<!-- User's Posts -->
<div class="container">
  {% for post in posts %}
  {% include '_post.html'%}
  {% endfor %}
  {% if prev_url %}
  <a href="{{ prev_url }}">Newer posts</a>
  {% endif %}
  {% if next_url %}
  <a href="{{ next_url }}">Older posts</a>
  {% endif %}
</div>

{% endblock %}